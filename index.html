<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duck Siders</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #87CEEB;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        
        #gameContainer {
            position: relative;
            width: 430px;
            height: 932px;
            overflow: hidden;
            border: 2px solid #333;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        
        #gameCanvas {
            display: block;
            width: 430px;
            height: 932px;
            background: #87CEEB;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
            text-align: center;
        }
        
        #readyScreen {
            display: none;
            background: rgba(1, 1, 1, 0.3);
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        #gameOverScreen {
            display: none;
        }
        
        button {
            background: #FFD700;
            color: #333;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 25px;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #FFD700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .finalScore {
            font-size: 24px;
            margin: 10px 0;
        }

        /* Временные стили для отладки */
        .debug-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            font-size: 12px;
            z-index: 1000;
            max-width: 300px;
            max-height: 200px;
            overflow: auto;
        }

        /* Подключаем шрифт PIXY */
        @font-face {
            font-family: 'PIXY';
            src: url('fonts/PIXY.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        /* Стили для экрана готовности */
        .ready-text {
            font-family: 'PIXY', Arial, sans-serif;
            font-size: 40px;
            color: white;
            text-align: center;
            line-height: 1.2;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
        }

        .blink {
            animation: pulse-animation 2s infinite;
        }

        @keyframes pulse-animation {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debugInfo"></div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas" width="430" height="932"></canvas>
        
        <div id="startScreen" class="screen">
            <h1>Duck Siders</h1>
            <p>Нажимай, чтобы лететь!</p>
            <button id="startButton">Начать игру</button>
        </div>
        
        <div id="readyScreen" class="screen">
            <div class="ready-text blink">
                <div>НАЖМИТЕ</div>
                <div>чтобы начать</div>
            </div>
        </div>
        
        <div id="gameOverScreen" class="screen">
            <h1>Марина красотка</h1>
            <div class="finalScore">Счет: <span id="finalScore">0</span></div>
            <div class="finalScore">Монетки: <span id="finalCoins">0</span></div>
            <div class="finalScore">Алмазы: <span id="finalDiamonds">0</span></div>
            <button id="restartButton">Играть снова</button>
        </div>
    </div>

    <script>
        // Функция для отладки
        function debugLog(message) {
            console.log(message);
            const debugInfo = document.getElementById('debugInfo');
            // Ограничим количество сообщений чтобы не перегружать
            const lines = debugInfo.innerHTML.split('<br>');
            if (lines.length > 20) {
                lines.shift();
            }
            debugInfo.innerHTML = lines.join('<br>') + message + '<br>';
        }

        // Основные переменные игры
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const finalScoreElement = document.getElementById('finalScore');
        const finalCoinsElement = document.getElementById('finalCoins');
        const finalDiamondsElement = document.getElementById('finalDiamonds');
        const startScreen = document.getElementById('startScreen');
        const readyScreen = document.getElementById('readyScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const gameContainer = document.getElementById('gameContainer');

        debugLog('Инициализация игры...');

        // Загрузка изображений
        const images = {
            bird: new Image(),
            pipeTop: new Image(),
            pipeBottom: new Image(),
            background: new Image(),
            ground: new Image(),
            sky: new Image(),
            scoreBoard: new Image(),
            coin: new Image(),
            coinScoreBoard: new Image(),
            diamond: new Image(),
            diamondScoreBoard: new Image()
        };

        // Укажите здесь пути к вашим изображениям
        images.bird.src = 'images/bird.png';
        images.pipeTop.src = 'images/pipe-top.png';
        images.pipeBottom.src = 'images/pipe-bottom.png';
        images.background.src = 'images/background.png';
        images.ground.src = 'images/ground.png';
        images.sky.src = 'images/sky.png';
        images.scoreBoard.src = 'images/score-board.png';
        images.coin.src = 'images/coin.png';
        images.coinScoreBoard.src = 'images/coin-score-board.png';
        images.diamond.src = 'images/diamond.png';
        images.diamondScoreBoard.src = 'images/diamond-score-board.png';

        let imagesLoaded = 0;
        const totalImages = Object.keys(images).length;
        let allImagesLoaded = false;

        debugLog(`Всего изображений для загрузки: ${totalImages}`);

        // Проверка загрузки всех изображений
        Object.entries(images).forEach(([name, img]) => {
            img.onload = () => {
                imagesLoaded++;
                debugLog(`✓ ${name} (${img.width}x${img.height})`);
                if (imagesLoaded === totalImages) {
                    allImagesLoaded = true;
                    debugLog('✓ Все изображения загружены!');
                    draw();
                }
            };
            img.onerror = () => {
                debugLog(`✗ ОШИБКА: ${name}`);
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    allImagesLoaded = true;
                    debugLog('✓ Продолжаем с фолбэками');
                    draw();
                }
            };
        });

        // Параметры игры
        let gameState = 'start';
        let score = 0;
        let coinsCount = 0;
        let diamondsCount = 0;
        let frames = 0;
        let pipeCounter = 0;
        let diamondPipeCounter = 0;

        // Параметры птицы
        const bird = {
            x: 80,
            y: 40,
            width: 87,
            height: 75,
            gravity: 0.4,
            lift: -9,
            velocity: 0,
            rotation: 0,
            
            init() {
                this.y = canvas.height / 2;
                this.velocity = 0;
                this.rotation = 0;
            },
            
            draw() {
                if (images.bird.complete && images.bird.naturalWidth > 0) {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(this.rotation);
                    ctx.drawImage(images.bird, -this.width/2, -this.height/2, this.width, this.height);
                    ctx.restore();
                } else {
                    // Фолбэк
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.width / 2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Добавим глаз для видимости
                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(this.x + 15, this.y - 10, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
            },
            
            update() {
                if (gameState !== 'playing') return;
                
                this.velocity += this.gravity;
                this.y += this.velocity;
                
                this.rotation = Math.max(-0.3, Math.min(0.3, this.velocity * 0.03));
                
                // Столкновение с землей
                const groundLevel = canvas.height - 172;
                if (this.y + this.height/2 >= groundLevel) {
                    this.y = groundLevel - this.height/2;
                    if (gameState === 'playing') {
                        gameOver();
                    }
                }
                
                // Столкновение с потолком (небом)
                const skyLevel = 114;
                if (this.y - this.height/2 <= skyLevel) {
                    this.y = skyLevel + this.height/2;
                    if (gameState === 'playing') {
                        gameOver();
                    }
                }
            },
            
            flap() {
                this.velocity = this.lift;
                this.rotation = -0.3;
            }
        };

        // Трубы
        const pipes = {
            position: [],
            gap: 250,
            dx: 3,
            width: 96,
            pipeHeight: 449,
            
            draw() {
                for (let i = 0; i < this.position.length; i++) {
                    let p = this.position[i];
                    
                    if (images.pipeTop.complete && images.pipeBottom.complete && 
                        images.pipeTop.naturalWidth > 0 && images.pipeBottom.naturalWidth > 0) {
                        // Верхняя труба
                        ctx.save();
                        ctx.translate(p.x + this.width/2, p.y + this.pipeHeight/2);
                        ctx.rotate(Math.PI);
                        ctx.drawImage(images.pipeTop, -this.width/2, -this.pipeHeight/2, this.width, this.pipeHeight);
                        ctx.restore();
                        
                        // Нижняя труба
                        let bottomY = p.y + this.pipeHeight + this.gap;
                        ctx.drawImage(images.pipeBottom, p.x, bottomY, this.width, this.pipeHeight);
                    } else {
                        // Фолбэк
                        ctx.fillStyle = '#75C235';
                        // Верхняя труба
                        ctx.fillRect(p.x, p.y, p.width, p.height);
                        
                        // Нижняя труба
                        let bottomY = p.y + p.height + this.gap;
                        ctx.fillRect(p.x, bottomY, p.width, canvas.height - bottomY);
                    }
                }
            },
            
            update() {
                if (gameState !== 'playing') return;
                
                if (frames % 100 === 0) {
                    const skyHeight = 114;
                    const groundHeight = 172;
                    const playableHeight = canvas.height - skyHeight - groundHeight;
                    const minPipeHeight = 50;
                    const maxPipeHeight = playableHeight - this.gap - minPipeHeight;
                    
                    if (maxPipeHeight > minPipeHeight) {
                        const height = minPipeHeight + Math.random() * (maxPipeHeight - minPipeHeight);
                    
                        this.position.push({
                            x: canvas.width,
                            y: skyHeight - height,
                            width: this.width,
                            height: canvas.height
                        });
                        
                        pipeCounter++;
                        diamondPipeCounter++;
                        
                        // Создание монеток
                        if (pipeCounter >= 5 && Math.random() < 1) {
                            createCoin();
                            pipeCounter = 0;
                        }
                        
                        // Создание алмазов каждые 8 труб с вероятностью 10%
                        if (diamondPipeCounter >= 8 && Math.random() < 1) {
                            createDiamond();
                            diamondPipeCounter = 0;
                        }
                    }
                }
                
                for (let i = this.position.length - 1; i >= 0; i--) {
                    let p = this.position[i];
                    p.x -= this.dx;
                    
                    if (this.collision(bird, p)) {
                        gameOver();
                    }
                    
                    if (p.x + p.width <= 0) {
                        this.position.splice(i, 1);
                        score++;
                    }
                }
            },
            
            collision(bird, pipe) {
                const hitboxScale = 0.8;
                const hitboxWidth = bird.width * hitboxScale;
                const hitboxHeight = bird.height * hitboxScale;
                
                const birdLeft = bird.x - hitboxWidth/2;
                const birdRight = bird.x + hitboxWidth/2;
                const birdTop = bird.y - hitboxHeight/2;
                const birdBottom = bird.y + hitboxHeight/2;
                
                const pipeRight = pipe.x + pipe.width;
                const pipeGapTop = pipe.y + this.pipeHeight;
                const pipeGapBottom = pipeGapTop + this.gap;
                
                // Проверяем столкновение с верхней трубой
                if (birdRight > pipe.x && birdLeft < pipeRight && 
                    birdTop < pipeGapTop && birdBottom > pipe.y) {
                    return true;
                }
                
                // Проверяем столкновение с нижней трубой
                if (birdRight > pipe.x && birdLeft < pipeRight && 
                    birdBottom > pipeGapBottom) {
                    return true;
                }
                
                return false;
            },
            
            reset() {
                this.position = [];
            }
        };

        // Монетки
        const coinManager = {
            items: [],
            width: 42,
            height: 39,
            dx: 3,
            animationSpeed: 0.05,
            
            draw() {
                for (let i = 0; i < this.items.length; i++) {
                    let coin = this.items[i];
                    
                    if (images.coin.complete && images.coin.naturalWidth > 0) {
                        ctx.drawImage(images.coin, coin.x, coin.y, this.width, this.height);
                    } else {
                        // Фолбэк
                        ctx.fillStyle = '#FFD700';
                        ctx.beginPath();
                        ctx.arc(coin.x + this.width/2, coin.y + this.height/2, this.width/2, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            },
            
            update() {
                if (gameState !== 'playing') return;
                
                for (let i = this.items.length - 1; i >= 0; i--) {
                    let coin = this.items[i];
                    coin.x -= this.dx;
                    
                    // Анимация движения вверх-вниз
                    coin.animationTime += this.animationSpeed;
                    coin.y = coin.baseY + Math.sin(coin.animationTime) * 10;
                    
                    if (this.collection(bird, coin)) {
                        this.items.splice(i, 1);
                        coinsCount++;
                    }
                    
                    if (coin.x + this.width <= 0) {
                        this.items.splice(i, 1);
                    }
                }
            },
            
            collection(bird, coin) {
                const hitboxScale = 0.8;
                const hitboxWidth = bird.width * hitboxScale;
                const hitboxHeight = bird.height * hitboxScale;
                
                const birdLeft = bird.x - hitboxWidth/2;
                const birdRight = bird.x + hitboxWidth/2;
                const birdTop = bird.y - hitboxHeight/2;
                const birdBottom = bird.y + hitboxHeight/2;
                
                const coinLeft = coin.x;
                const coinRight = coin.x + this.width;
                const coinTop = coin.y;
                const coinBottom = coin.y + this.height;
                
                return (
                    birdRight > coinLeft &&
                    birdLeft < coinRight &&
                    birdBottom > coinTop &&
                    birdTop < coinBottom
                );
            },
            
            reset() {
                this.items = [];
            }
        };

        // Алмазы
        const diamondManager = {
            items: [],
            width: 42,
            height: 33,
            dx: 3,
            animationSpeed: 0.05,
            
            draw() {
                for (let i = 0; i < this.items.length; i++) {
                    let diamond = this.items[i];
                    
                    if (images.diamond.complete && images.diamond.naturalWidth > 0) {
                        ctx.drawImage(images.diamond, diamond.x, diamond.y, this.width, this.height);
                    } else {
                        // Фолбэк
                        ctx.fillStyle = '#00BFFF';
                        ctx.beginPath();
                        ctx.moveTo(diamond.x + this.width/2, diamond.y);
                        ctx.lineTo(diamond.x + this.width, diamond.y + this.height/2);
                        ctx.lineTo(diamond.x + this.width/2, diamond.y + this.height);
                        ctx.lineTo(diamond.x, diamond.y + this.height/2);
                        ctx.closePath();
                        ctx.fill();
                    }
                }
            },
            
            update() {
                if (gameState !== 'playing') return;
                
                for (let i = this.items.length - 1; i >= 0; i--) {
                    let diamond = this.items[i];
                    diamond.x -= this.dx;
                    
                    // Анимация движения вверх-вниз
                    diamond.animationTime += this.animationSpeed;
                    diamond.y = diamond.baseY + Math.sin(diamond.animationTime) * 10;
                    
                    if (this.collection(bird, diamond)) {
                        this.items.splice(i, 1);
                        diamondsCount++;
                    }
                    
                    if (diamond.x + this.width <= 0) {
                        this.items.splice(i, 1);
                    }
                }
            },
            
            collection(bird, diamond) {
                const hitboxScale = 0.8;
                const hitboxWidth = bird.width * hitboxScale;
                const hitboxHeight = bird.height * hitboxScale;
                
                const birdLeft = bird.x - hitboxWidth/2;
                const birdRight = bird.x + hitboxWidth/2;
                const birdTop = bird.y - hitboxHeight/2;
                const birdBottom = bird.y + hitboxHeight/2;
                
                const diamondLeft = diamond.x;
                const diamondRight = diamond.x + this.width;
                const diamondTop = diamond.y;
                const diamondBottom = diamond.y + this.height;
                
                return (
                    birdRight > diamondLeft &&
                    birdLeft < diamondRight &&
                    birdBottom > diamondTop &&
                    birdTop < diamondBottom
                );
            },
            
            reset() {
                this.items = [];
            }
        };

        // Функция создания монетки
        function createCoin() {
            if (pipes.position.length > 0) {
                const lastPipe = pipes.position[pipes.position.length - 1];
                const coinX = lastPipe.x + pipes.width + 50;
                const baseY = lastPipe.y + pipes.pipeHeight + pipes.gap/2 - coinManager.height/2;
                
                coinManager.items.push({ 
                    x: coinX, 
                    y: baseY,
                    baseY: baseY,
                    animationTime: Math.random() * Math.PI * 2
                });
            }
        }

        // Функция создания алмаза
        function createDiamond() {
            if (pipes.position.length > 0) {
                const lastPipe = pipes.position[pipes.position.length - 1];
                const diamondX = lastPipe.x + pipes.width + 50;
                const baseY = lastPipe.y + pipes.pipeHeight + pipes.gap/2 - diamondManager.height/2;
                
                diamondManager.items.push({ 
                    x: diamondX, 
                    y: baseY,
                    baseY: baseY,
                    animationTime: Math.random() * Math.PI * 2
                });
            }
        }

        // Фон
        const background = {
            draw() {
                if (images.background.complete && images.background.naturalWidth > 0) {
                    ctx.drawImage(images.background, 0, 0, canvas.width, canvas.height);
                } else {
                    ctx.fillStyle = '#87CEEB';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
            }
        };

        // Небо
        const sky = {
            draw() {
                if (images.sky.complete && images.sky.naturalWidth > 0) {
                    const skyHeight = 114;
                    ctx.drawImage(images.sky, 0, 0, canvas.width, skyHeight);
                } else {
                    ctx.fillStyle = '#87CEEB';
                    ctx.fillRect(0, 0, canvas.width, 114);
                }
            }
        };

        // Земля
        const ground = {
            draw() {
                if (images.ground.complete && images.ground.naturalWidth > 0) {
                    const groundHeight = 172;
                    ctx.drawImage(images.ground, 0, canvas.height - groundHeight, canvas.width, groundHeight);
                } else {
                    ctx.fillStyle = '#5C9400';
                    ctx.fillRect(0, canvas.height - 172, canvas.width, 172);
                }
            }
        };

        // Счетчик очков
        const scoreBoard = {
            draw() {
                if (images.scoreBoard.complete && images.scoreBoard.naturalWidth > 0) {
                    ctx.drawImage(images.scoreBoard, 146, 60, 138, 36);
                } else {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(146, 60, 138, 36);
                    
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(146, 60, 138, 36);
                }
                
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 30px "PIXY", Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(score.toString(), 146 + 138/2, 60 + 36/2);
            }
        };

        // Счетчик монеток
        const coinScoreBoard = {
            draw() {
                if (images.coinScoreBoard.complete && images.coinScoreBoard.naturalWidth > 0) {
                    ctx.drawImage(images.coinScoreBoard, 27, 60, 87, 45);
                } else {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(27, 60, 87, 45);
                    
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(27, 60, 87, 45);
                }
                
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 25px "PIXY", Arial, sans-serif';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';
                ctx.fillText(coinsCount.toString(), 76, 60 + 45/2);
            }
        };

        // Счетчик алмазов
        const diamondScoreBoard = {
            draw() {
                if (images.diamondScoreBoard.complete && images.diamondScoreBoard.naturalWidth > 0) {
                    ctx.drawImage(images.diamondScoreBoard, 316, 60, 87, 45);
                } else {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(316, 60, 87, 45);
                    
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(316, 60, 87, 45);
                }
                
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 25px "PIXY", Arial, sans-serif';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';
                ctx.fillText(diamondsCount.toString(), 340, 60 + 45/2);
            }
        };

        // Функции игры
        function gameOver() {
            gameState = 'gameover';
            finalScoreElement.textContent = score;
            finalCoinsElement.textContent = coinsCount;
            finalDiamondsElement.textContent = diamondsCount;
            gameOverScreen.style.display = 'flex';
        }

        function resetGame() {
            score = 0;
            coinsCount = 0;
            diamondsCount = 0;
            frames = 0;
            pipeCounter = 0;
            diamondPipeCounter = 0;
            bird.init();
            pipes.reset();
            coinManager.reset();
            diamondManager.reset();
            gameState = 'ready';
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            readyScreen.style.display = 'flex';
        }

        function startPlaying() {
            gameState = 'playing';
            readyScreen.style.display = 'none';
            bird.flap();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            background.draw();
            pipes.draw();
            coinManager.draw();
            diamondManager.draw();
            ground.draw();
            sky.draw();
            
            scoreBoard.draw();
            coinScoreBoard.draw();
            diamondScoreBoard.draw();
            bird.draw();
        }

        function update() {
            if (gameState !== 'playing') return;
            
            frames++;
            bird.update();
            pipes.update();
            coinManager.update();
            diamondManager.update();
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Управление
        function handleClick(event) {
            if (event.target.tagName === 'BUTTON') {
                return;
            }
            
            if (gameState === 'start') {
                resetGame();
            } else if (gameState === 'ready') {
                startPlaying();
            } else if (gameState === 'playing') {
                bird.flap();
            }
        }

        // Инициализация
        function init() {
            bird.init();
            
            gameContainer.addEventListener('click', handleClick);
            startButton.addEventListener('click', resetGame);
            restartButton.addEventListener('click', resetGame);
            
            gameLoop();
        }

        // Запуск игры
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>