async function init() {
    resizeCanvas();
    
    lockOrientation();
    
    // ИСПРАВЛЕНО: Добавляем обработчик клика на весь экран готовности
    readyScreen.addEventListener('touchstart', handleReadyScreenClick, { passive: false });
    readyScreen.addEventListener('mousedown', handleReadyScreenClick, { passive: false });
    readyScreen.addEventListener('click', handleReadyScreenClick, { passive: false });
    
    canvas.addEventListener('touchstart', handleGameInput, { passive: false });
    canvas.addEventListener('mousedown', handleGameInput, { passive: false });
    
    // Обработчик для кнопки старта в лобби
    lobbyStartButton.addEventListener('click', async function(e) {
        e.stopPropagation();
        e.preventDefault();
        console.log('Start button clicked, transitioning to ready screen');
        await resetGame();
    }, { passive: false });
    
    restartButton.addEventListener('click', async function(e) {
        e.stopPropagation();
        e.preventDefault();
        await resetGame();
    }, { passive: false });
    
    toLobbyButton.addEventListener('click', function(e) {
        e.stopPropagation();
        e.preventDefault();
        showLobby();
    }, { passive: false });
    
    window.addEventListener('resize', handleResize);
    window.addEventListener('orientationchange', handleResize);
    
    gameContainer.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        return false;
    });
    
    document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
    });
    
    bird.init();
    
    await loadProgress();
    
    // Показываем лобби при запуске
    showLobby();
    
    gameLoop();
    
    if (telegram.WebApp) {
        setTimeout(() => {
            if (!telegram.WebApp.isExpanded) {
                telegram.WebApp.expand();
            }
            
            setTimeout(() => {
                resizeCanvas();
                // Перерисовываем лобби после изменения размеров
                if (gameState === 'lobby') {
                    draw();
                }
            }, 1000);
        }, 500);
    }
}
